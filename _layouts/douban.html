---
layout: default
---

<link rel="stylesheet" href="/assets/css/douban.css">
<style>
    .status-bubble {
        -webkit-tap-highlight-color: transparent;
    }

    @media (min-width: 769px) {
        .status-popup {
            display: none !important;
        }
    }

    .infinite-spinner {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 20px;
        color: #666;
    }

    .spinner {
        width: 24px;
        height: 24px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #2d8c3c;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<div class="douban-feed-container">
    <nav class="douban-years-nav">
        {% assign years = "2026,2025,2024,2023,2022,2021" | split: "," %}
        {% for y in years %}
        {% if site.data.douban[y] %}
        <a href="/douban/{{ y }}.html" class="year-nav-link {% if y == page.year %}active{% endif %}">{{ y }}</a>
        {% endif %}
        {% endfor %}
    </nav>

    {% assign year_str = page.year | append: "" %}
    {% assign summary_data = site.data.douban_summaries[year_str] %}
    {% assign total_count = site.data.douban[year_str] | size %}

    <div style="text-align: right; color: #999; font-size: 0.9rem; margin-bottom: 10px;">
        共 {{ total_count }} 条广播
    </div>

    <div class="douban-summary-box"
        style="margin-bottom: 30px; padding: 25px; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid #f0f0f0;">
        {% if summary_data %}
        <div class="annual-keywords" style="margin-bottom: 20px;">
            <h3 style="font-size: 1.1rem; color: #333; margin-bottom: 12px; font-weight: 600;">{{ page.year }} 年度关键词
            </h3>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                {% for keyword in summary_data.keywords %}
                <span
                    style="background: #f5f7fa; color: #555; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; border: 1px solid #e1e4e8;">{{
                    keyword }}</span>
                {% endfor %}
            </div>
        </div>

        <div class="test" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
            <h3 style="font-size: 1.1rem; color: #333; margin-bottom: 10px; font-weight: 600;">年度回顾</h3>
            <p style="color: #444; line-height: 1.8; font-size: 1rem; margin: 0;">{{ summary_data.summary }}</p>
        </div>
        {% else %}
        <div id="history-today-container">
            <h3 id="history-today-title" style="font-size: 1.1rem; color: #333; margin-bottom: 12px; font-weight: 600;">
                历史上的今天</h3>
            <div id="history-today-list" style="display: flex; flex-direction: column; gap: 10px;"></div>
            <p id="history-today-empty" style="display:none; color: #999; font-size: 0.95rem;">历史上的今天暂无记录。</p>
        </div>

        <div id="history-modal" class="history-modal" style="display:none;">
            <div class="history-modal-backdrop"></div>
            <div class="history-modal-content">
                <button class="history-modal-close">&times;</button>
                <div class="history-modal-image-container"></div>
            </div>
        </div>

        <script>
            (function () {
                try {
                    var historyData = [];
                    {% assign history_years = "2026,2025,2024,2023,2022,2021" | split: "," %}
                    {% for y in history_years %}
                    {% if site.data.douban[y] %}
                    {% for item in site.data.douban[y] %}
                    historyData.push({
                        time: "{{ item.time }}",
                        content: {{ item.content | jsonify }},
                        images: {{ item.images | jsonify }},
                        year: "{{ y }}"
                    });
                    {% endfor %}
                    {% endif %}
                    {% endfor %}

            var today = new Date();
            var month = String(today.getMonth() + 1).padStart(2, '0');
            var day = String(today.getDate()).padStart(2, '0');
            var searchDate = month + '-' + day;

            var titleEl = document.getElementById('history-today-title');
            if (titleEl) {
                titleEl.innerText = '历史上的今天 ' + searchDate;
            }

            var matches = historyData.filter(function (item) {
                return item.time.substring(5, 10) === searchDate && item.year !== String(today.getFullYear());
            });

            matches.sort(function (a, b) {
                return b.year - a.year;
            });

            var list = document.getElementById('history-today-list');
            var emptyMsg = document.getElementById('history-today-empty');
            var container = document.getElementById('history-today-container');
            var modal = document.getElementById('history-modal');
            var modalContainer = modal ? modal.querySelector('.history-modal-image-container') : null;

            var isMobile = window.innerWidth <= 768;

            function openHistoryImage(imgUrl) {
                if (!modal || !modalContainer) return;

                if (isMobile) {
                    modal.style.display = 'flex';
                    modalContainer.innerHTML = '<img src="' + imgUrl + '" style="width:100%; height:auto; display:block;">';
                    document.body.style.overflow = 'hidden';
                } else {
                    modal.style.display = 'flex';
                    modalContainer.innerHTML = '<img src="' + imgUrl + '" style="max-width:90vw; max-height:90vh; display:block; margin:auto;">';
                }
            }

            function closeHistoryModal() {
                if (!modal) return;
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }

            if (modal) {
                modal.querySelector('.history-modal-close').addEventListener('click', closeHistoryModal);
                modal.querySelector('.history-modal-backdrop').addEventListener('click', closeHistoryModal);
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && modal.style.display !== 'none') {
                        closeHistoryModal();
                    }
                });
            }

            if (list && emptyMsg) {
                if (matches.length > 0) {
                    matches.forEach(function (item) {
                        var c = item.content || "";
                        var filterRegex = /(导演|表演者|Author|主演|类型|出版)\s*[:：]/;
                        if (filterRegex.test(c)) {
                            return;
                        }
                        var el = document.createElement('div');
                        el.style.cssText = "padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 0.95rem; color: #555; line-height: 1.5;";

                        var content = item.content;

                        var html = '<span style="color:#2d8c3c; font-weight:600; margin-right:8px; display:inline-block; min-width:38px;">' + item.year + '</span> ' + content;

                        if (item.images && item.images.length > 0) {
                            html += '<div class="history-images-wrapper" style="margin-top:8px; display:flex; gap:5px; flex-wrap:wrap;">';
                            item.images.forEach(function(imgUrl) {
                                if (isMobile) {
                                    html += '<img src="' + imgUrl + '" class="history-mobile-image" style="width:80px; height:80px; object-fit:cover; border-radius:4px; cursor:pointer;" onclick="this.style.width=\'100%\'; this.style.height=\'auto\'; this.style.objectFit=\'contain\';">';
                                } else {
                                    html += '<img src="' + imgUrl + '" class="history-desktop-image" style="width:80px; height:80px; object-fit:cover; border-radius:4px; cursor:pointer;" onclick="openHistoryImage(\'' + imgUrl + '\')">';
                                }
                            });
                            html += '</div>';
                        }

                        el.innerHTML = html;
                        list.appendChild(el);
                    });
                } else {
                    emptyMsg.style.display = 'block';
                }
            }
                } catch (e) {
                console.error("Error generating History Today:", e);
            }
            }) ();
        </script>
        {% endif %}
    </div>

    <div id="douban-month-filter" class="douban-month-filter"></div>
    <div class="douban-feed-list" id="douban-feed-list" data-api-base="/api/douban/{{ page.year }}"></div>

    <div class="infinite-loading" id="douban-loading" style="display: none;">
        <div class="infinite-spinner">
            <div class="spinner"></div>
            <span>加载中...</span>
        </div>
    </div>

    <div class="infinite-end" id="douban-end" style="display: none; text-align: center; padding: 30px; color: #999;">
        <span>— 已经到底啦 —</span>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const feedList = document.getElementById('douban-feed-list');
        const monthFilter = document.getElementById('douban-month-filter');
        const apiBase = feedList.dataset.apiBase;

        let currentMonth = null;
        let currentPage = 1;
        let isLoading = false;
        let hasMore = true;
        let allItems = [];

        function renderStatusItem(status, index) {
            const imagesHtml = status.images && status.images.length > 0
                ? `<div class="status-images">${status.images.map(img =>
                    `<div class="status-image-thumb" style="background-image: url('${img}');"></div>`).join('')}</div>`
                : '';

            const now = new Date();
            const statusDate = new Date(status.time.replace(' ', 'T'));
            const diffMs = now - statusDate;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffMs / (1000 * 60));

            let timeDisplay;
            if (diffDays < 7 && diffDays >= 0) {
                if (diffDays > 0) {
                    timeDisplay = `${diffDays}Day ${diffHours % 24}h`;
                } else if (diffHours > 0) {
                    timeDisplay = `${diffHours}h ${diffMinutes % 60}m`;
                } else {
                    timeDisplay = `${diffMinutes}m`;
                }
            } else {
                const year = statusDate.getFullYear();
                const month = String(statusDate.getMonth() + 1).padStart(2, '0');
                const day = String(statusDate.getDate()).padStart(2, '0');
                timeDisplay = `${year}-${month}-${day}`;
            }

            return `
                <div class="douban-status-item" data-status-id="status-${index}" data-month="${status.time.substring(5, 7)}">
                    <div class="status-avatar">
                        <img src="/images/douban_avatar.jpg" alt="Stuart Lau" class="no-click-zoom">
                    </div>
                    <div class="status-bubble" data-popup-target="popup-${index}">
                        <div class="status-header-row">
                            <span class="status-author">@stuartlau</span>
                            <span class="status-time">${timeDisplay}</span>
                        </div>
                        <div class="status-content">${status.content}</div>
                        ${imagesHtml}
                        <div class="status-footer">
                            <div class="giscus-stats" onclick="event.stopPropagation(); toggleGiscus(this)" title="点击展开评论">
                                <span class="giscus-count-item comment-count"
                                    style="display:inline-flex; align-items:center; gap:4px; font-size:0.9rem; color:#888;">
                                    <svg class="giscus-icon" viewBox="0 0 16 16" version="1.1" width="14" height="14"
                                        aria-hidden="true" style="fill:currentColor;">
                                        <path
                                            d="M1 2.75C1 1.784 1.784 1 2.75 1h10.5c.966 0 1.75.784 1.75 1.75v7.5A1.75 1.75 0 0 1 13.25 12H9.06l-2.573 2.573A1.457 1.457 0 0 1 4 13.543V12H2.75A1.75 1.75 0 0 1 1 10.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.75.75 0 0 1 .53-.22h4.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z">
                                        </path>
                                    </svg>
                                    <span class="count-text">...</span>
                                </span>
                                <span class="giscus-count-item reaction-count"
                                    style="display:inline-flex; align-items:center; gap:4px; font-size:0.9rem; color:#888; margin-left:8px;">
                                    <svg class="giscus-icon" viewBox="0 0 16 16" version="1.1" width="14" height="14"
                                        aria-hidden="true" style="fill:currentColor;">
                                        <path
                                            d="m8 14.25.345.666a.75.75 0 0 1-.69 0l-.008-.004-.018-.01a7.152 7.152 0 0 1-.31-.17 22.055 22.055 0 0 1-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.066 22.066 0 0 1-3.744 2.584l-.018.01-.006.003h-.002ZM4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.58 20.58 0 0 0 8 13.393a20.58 20.58 0 0 0 3.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.749.749 0 0 1-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5Z">
                                        </path>
                                    </svg>
                                    <span class="count-text">...</span>
                                </span>
                            </div>
                        </div>
                        <div class="giscus-wrapper" id="giscus-${index}"
                            data-term="douban-${status.time.replace(/ /g, '-').replace(/:/g, '-')}-${status.content ? status.content.length : 0}"
                            style="display:none; margin-top: 15px;" onclick="event.stopPropagation()"></div>
                    </div>
                </div>
                <div class="status-popup" id="popup-${index}" data-status-id="status-${index}">
                    <button class="status-popup-close">×</button>
                    <div class="status-popup-content">
                        <div class="status-popup-header">
                            <div class="status-popup-avatar">
                                <img src="/images/douban_avatar.jpg" alt="Stuart Lau" class="no-click-zoom">
                            </div>
                            <div class="status-popup-meta">
                                <span class="status-popup-author">@stuartlau</span>
                                <span class="status-popup-time">${timeDisplay}</span>
                            </div>
                        </div>
                        <div class="status-popup-text">${status.content}</div>
                        ${status.images && status.images.length > 0
                            ? `<div class="status-popup-images">${status.images.map(img =>
                                `<img src="${img}" class="status-popup-image-full">`).join('')}</div>`
                            : ''}
                    </div>
                </div>
            `;
        }

        async function loadStatuses() {
            if (isLoading || !hasMore) return;

            isLoading = true;
            document.getElementById('douban-loading').style.display = 'block';

            try {
                let url = `${apiBase}/page-${currentPage}.json`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch');

                const data = await response.json();

                if (data.data && data.data.length > 0) {
                    let lastMonth = '';
                    data.data.forEach((status, idx) => {
                        const contentToCheck = (status.content || '').strip();
                        if (contentToCheck.includes('导演:') || contentToCheck.includes('表演者:') ||
                            contentToCheck.includes('作者:')) {
                            return;
                        }

                        const currentMonth = status.time.substring(5, 7);
                        if (currentMonth !== lastMonth) {
                            const separator = document.createElement('div');
                            separator.className = 'month-separator';
                            separator.dataset.month = currentMonth;
                            separator.textContent = `${currentMonth}月`;
                            feedList.appendChild(separator);
                            lastMonth = currentMonth;
                        }

                        const itemHtml = renderStatusItem(status, allItems.length + 1000);
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = itemHtml;
                        const item = tempDiv.firstElementChild;
                        item.style.opacity = '0';
                        item.style.transform = 'translateY(10px)';
                        feedList.appendChild(item);

                        requestAnimationFrame(() => {
                            item.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                            item.style.opacity = '1';
                            item.style.transform = 'translateY(0)';
                        });

                        allItems.push(item);
                    });

                    currentPage++;
                    hasMore = data.page < data.total_pages;
                } else {
                    hasMore = false;
                }

                if (!hasMore) {
                    document.getElementById('douban-end').style.display = 'block';
                }
            } catch (error) {
                console.error('Failed to load statuses:', error);
                document.getElementById('douban-loading').querySelector('span').textContent = '加载失败，点击重试';
                document.getElementById('douban-loading').style.cursor = 'pointer';
                document.getElementById('douban-loading').onclick = loadStatuses;
            } finally {
                isLoading = false;
                if (hasMore) {
                    document.getElementById('douban-loading').style.display = 'none';
                }
            }
        }

        function setupMonthFilter() {
            const pageYear = parseInt("{{ page.year }}");
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth() + 1;

            const maxMonth = 12;
            if (pageYear === currentYear) {
                if (currentMonth === 1) return;
            }

            for (let m = 1; m <= maxMonth; m++) {
                const btn = document.createElement('button');
                const mStr = (m < 10 ? '0' : '') + m;
                btn.textContent = m + '月';
                btn.className = 'month-filter-btn';
                btn.setAttribute('data-target-month', mStr);

                btn.onclick = function () {
                    const target = this.getAttribute('data-target-month');
                    const isActive = this.classList.contains('active');

                    const allBtns = monthFilter.querySelectorAll('.month-filter-btn');
                    allBtns.forEach(b => b.classList.remove('active'));

                    if (!isActive) {
                        this.classList.add('active');
                        filterMonth(target);
                    } else {
                        filterMonth(null);
                    }
                };
                monthFilter.appendChild(btn);
            }

            const firstBtn = monthFilter.querySelector('.month-filter-btn');
            if (firstBtn) {
                firstBtn.click();
            }
        }

        function filterMonth(m) {
            currentMonth = m;
            feedList.innerHTML = '';
            allItems = [];
            currentPage = 1;
            hasMore = true;

            document.getElementById('douban-end').style.display = 'none';

            loadStatuses();
        }

        setupMonthFilter();

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && hasMore && !isLoading) {
                    loadStatuses();
                }
            });
        }, { rootMargin: '200px' });

        const endIndicator = document.getElementById('douban-end');
        if (endIndicator) {
            observer.observe(endIndicator);
        }
    });
</script>

<script>
    // Desktop Lightbox Functionality
    document.addEventListener('DOMContentLoaded', function () {
        if (window.innerWidth <= 768) return;

        var lightbox = document.createElement('div');
        lightbox.id = 'desktop-lightbox';
        lightbox.style.cssText = 'display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center; user-select:none;';

        lightbox.innerHTML = ' \
            <div class="lightbox-close-btn">&times;</div> \
            <div class="lightbox-counter"></div> \
            <div class="lightbox-nav prev">&lsaquo;</div> \
            <div class="lightbox-nav next">&rsaquo;</div> \
            <img src="" style="max-width:90%; max-height:90%; border-radius:4px; box-shadow:0 0 20px rgba(0,0,0,0.5);"> \
        ';
        document.body.appendChild(lightbox);

        var lbImg = lightbox.querySelector('img');
        var counter = lightbox.querySelector('.lightbox-counter');
        var prevBtn = lightbox.querySelector('.prev');
        var nextBtn = lightbox.querySelector('.next');
        var closeBtn = lightbox.querySelector('.lightbox-close-btn');

        var currentGroup = [];
        var currentIndex = 0;

        function updateLightbox() {
            if (currentGroup.length === 0) return;
            lbImg.src = currentGroup[currentIndex];
            counter.textContent = (currentIndex + 1) + ' / ' + currentGroup.length;

            prevBtn.style.display = currentGroup.length > 1 ? 'flex' : 'none';
            nextBtn.style.display = currentGroup.length > 1 ? 'flex' : 'none';

            if (currentIndex === 0) prevBtn.classList.add('disabled');
            else prevBtn.classList.remove('disabled');

            if (currentIndex === currentGroup.length - 1) nextBtn.classList.add('disabled');
            else nextBtn.classList.remove('disabled');
        }

        function closeLightbox() {
            lightbox.style.display = 'none';
            currentGroup = [];
        }

        function showNext() {
            if (currentIndex < currentGroup.length - 1) {
                currentIndex++;
                updateLightbox();
            }
        }

        function showPrev() {
            if (currentIndex > 0) {
                currentIndex--;
                updateLightbox();
            }
        }

        lightbox.addEventListener('click', function (e) {
            if (e.target === lightbox || e.target === closeBtn) {
                closeLightbox();
            }
        });

        prevBtn.addEventListener('click', function (e) {
            e.stopPropagation();
            showPrev();
        });

        nextBtn.addEventListener('click', function (e) {
            e.stopPropagation();
            showNext();
        });

        document.addEventListener('keydown', function (e) {
            if (lightbox.style.display === 'none') return;

            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') showPrev();
            if (e.key === 'ArrowRight') showNext();
        });

        document.body.addEventListener('click', function (e) {
            if (e.target.classList.contains('status-image-thumb')) {
                var parent = e.target.closest('.status-images');
                if (parent) {
                    var thumbs = Array.from(parent.querySelectorAll('.status-image-thumb'));
                    currentGroup = thumbs.map(function (t) {
                        var bg = t.style.backgroundImage;
                        if (bg.indexOf('"') > -1) {
                            return bg.slice(5, -2);
                        } else {
                            return bg.slice(4, -1);
                        }
                    });
                    currentIndex = thumbs.indexOf(e.target);

                    if (currentIndex !== -1) {
                        lightbox.style.display = 'flex';
                        updateLightbox();
                    }
                }
            }
        });
    });

    // Mobile popup functionality
    document.addEventListener('DOMContentLoaded', function () {
        if (window.innerWidth > 768) return;

        document.addEventListener('click', function (e) {
            const bubble = e.target.closest('.status-bubble');
            if (!bubble) return;

            if (e.target.tagName === 'A') return;
            if (e.target.closest('.status-footer') || e.target.closest('.comment-box') || e.target.closest('.giscus-wrapper')) return;

            const popupId = bubble.getAttribute('data-popup-target');
            if (!popupId) return;

            const popup = document.getElementById(popupId);
            if (popup) {
                document.querySelectorAll('.status-popup').forEach(p => {
                    p.classList.remove('active');
                });

                document.body.style.overflow = 'hidden';
                popup.classList.add('active');
                e.stopPropagation();
            }
        });

        document.addEventListener('click', function (e) {
            const popup = e.target.closest('.status-popup');
            const closeBtn = e.target.closest('.status-popup-close');

            if (closeBtn || (popup && e.target === popup)) {
                document.body.style.overflow = '';
                document.querySelectorAll('.status-popup').forEach(p => {
                    p.classList.remove('active');
                });
                e.stopPropagation();
            }
        });

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                document.body.style.overflow = '';
                document.querySelectorAll('.status-popup').forEach(popup => {
                    popup.classList.remove('active');
                });
            }
        });
    });

    // Handle window resize
    window.addEventListener('resize', function () {
        if (window.innerWidth > 768) {
            document.body.style.overflow = '';
            document.querySelectorAll('.status-popup').forEach(popup => {
                popup.classList.remove('active');
            });
        }
    });

    // Giscus Stats Lazy Loading
    document.addEventListener('DOMContentLoaded', function () {
        console.log('Giscus Stats: Initializing Observer...');
        var statsObserver = new IntersectionObserver(function (entries, observer) {
            entries.forEach(function (entry) {
                if (entry.isIntersecting) {
                    var statsEl = entry.target;
                    if (!statsEl.hasAttribute('data-fetched')) {
                        fetchGiscusStats(statsEl);
                        statsEl.setAttribute('data-fetched', 'true');
                    }
                    observer.unobserve(statsEl);
                }
            });
        }, { rootMargin: '50px' });

        document.querySelectorAll('.giscus-stats').forEach(function (el) {
            statsObserver.observe(el);
        });
    });

    function fetchGiscusStats(el) {
        var hostname = window.location.hostname;
        if (hostname === 'localhost' || hostname === '127.0.0.1' || hostname.includes('192.168')) {
            console.log('Giscus Stats: Skipped on local dev environment');
            el.querySelector('.comment-count .count-text').textContent = '-';
            el.querySelector('.reaction-count .count-text').textContent = '-';
            return;
        }

        var bubble = el.closest('.status-bubble');
        if (!bubble) return;
        var wrapper = bubble.querySelector('.giscus-wrapper');
        if (!wrapper) return;
        var term = wrapper.getAttribute('data-term');
        if (!term) return;

        console.log('Giscus Stats: Fetching for term:', term);

        var repo = "stuartlau/stuartlau.github.io";
        var category = "Announcements";
        var url = "https://giscus.app/api/discussions?repo=" + repo + "&category=" + category + "&term=" + encodeURIComponent(term) + "&strict=0";

        fetch(url)
            .then(function (res) {
                if (res.status === 404) {
                    return null;
                }
                if (!res.ok) throw new Error('API Error ' + res.status);
                return res.json();
            })
            .then(function (data) {
                var comments = 0;
                var reactions = 0;

                if (data && data.discussion) {
                    comments = data.discussion.totalCommentCount || 0;
                    if (data.discussion.reactions && data.discussion.reactions.totalCount !== undefined) {
                        reactions = data.discussion.reactions.totalCount;
                    } else if (data.discussion.reactionCount !== undefined) {
                        reactions = data.discussion.reactionCount;
                    } else {
                        var reactionGroups = data.discussion.reactionGroups;
                        if (Array.isArray(reactionGroups)) {
                            reactions = reactionGroups.reduce(function (sum, g) {
                                return sum + (g.users && g.users.totalCount ? g.users.totalCount : 0);
                            }, 0);
                        }
                    }
                }

                var commentText = el.querySelector('.comment-count .count-text');
                var reactionText = el.querySelector('.reaction-count .count-text');

                if (commentText) commentText.textContent = comments;
                if (reactionText) reactionText.textContent = reactions;

                if (comments > 0 || reactions > 0) {
                    el.classList.add('has-interaction');
                }

                console.log('Giscus Stats: term=' + term + ', comments=' + comments + ', reactions=' + reactions);
            })
            .catch(function (err) {
                console.error('Giscus Stats: Failed to fetch', err);
                var commentText = el.querySelector('.comment-count .count-text');
                var reactionText = el.querySelector('.reaction-count .count-text');
                if (commentText) commentText.textContent = "0";
                if (reactionText) reactionText.textContent = "0";
            });
    }
</script>
<script src="/assets/js/giscus-handler.js"></script>