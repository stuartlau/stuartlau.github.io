---
layout: default
---

<link rel="stylesheet" href="/assets/css/douban.css">
<style>
    /* Ensure proper touch handling on mobile */
    .status-bubble {
        -webkit-tap-highlight-color: transparent;
    }
    
    /* Hide popup on desktop */
    @media (min-width: 769px) {
        .status-popup {
            display: none !important;
        }
    }
</style>

<div class="douban-feed-container">
    <nav class="douban-years-nav">
        {% assign years = "2026,2025,2024,2023,2022,2021" | split: "," %}
        {% for y in years %}
        {% if site.data.douban[y] %}
        <a href="/douban/{{ y }}.html" class="year-nav-link {% if y == page.year %}active{% endif %}">{{ y }}</a>
        {% endif %}
        {% endfor %}
    </nav>

    {% assign year_str = page.year | append: "" %}
    {% assign summary_data = site.data.douban_summaries[year_str] %}
    {% assign total_count = site.data.douban[year_str] | size %}

    <div style="text-align: right; color: #999; font-size: 0.9rem; margin-bottom: 10px;">
        共 {{ total_count }} 条广播
    </div>

    <div class="douban-summary-box"
        style="margin-bottom: 30px; padding: 25px; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid #f0f0f0;">
        {% if summary_data %}
        <div class="annual-keywords" style="margin-bottom: 20px;">
            <h3 style="font-size: 1.1rem; color: #333; margin-bottom: 12px; font-weight: 600;">{{ page.year }} 年度关键词
            </h3>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                {% for keyword in summary_data.keywords %}
                <span
                    style="background: #f5f7fa; color: #555; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; border: 1px solid #e1e4e8;">{{
                    keyword }}</span>
                {% endfor %}
            </div>
        </div>

        <div class="test" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px;">
            <h3 style="font-size: 1.1rem; color: #333; margin-bottom: 10px; font-weight: 600;">年度回顾</h3>
            <p style="color: #444; line-height: 1.8; font-size: 1rem; margin: 0;">{{ summary_data.summary }}</p>
        </div>
        {% else %}
        <p>回顾 {{ page.year }} 年的精彩瞬间。</p>
        {% endif %}
    </div>

    <div class="douban-feed-list">
        {% assign year_str = page.year | append: "" %}
        {% assign year_data = site.data.douban[year_str] %}

        {% if year_data %}
        {% assign last_month = "" %}
        {% for status in year_data %}
        {% assign content_to_check = status.content | strip %}
        {% if content_to_check contains '导演:' or 
              content_to_check contains '表演者:' or 
              content_to_check contains '作者:' %}
            {% continue %}
        {% endif %}
        {% assign current_month = status.time | slice: 5, 2 %}
        {% if current_month != last_month %}
        <div class="month-separator">{{ current_month }}月</div>
        {% assign last_month = current_month %}
        {% endif %}

        <div class="douban-status-item" data-status-id="status-{{ forloop.index }}">
            <div class="status-avatar">
                <img src="/images/douban_avatar.jpg" alt="Avatar">
            </div>
            <div class="status-bubble" data-popup-target="popup-{{ forloop.index }}">
                <div class="status-content">{{ status.content }}</div>
                <div class="status-header">
                    <span class="status-time">{{ status.time }}</span>
                </div>
            </div>
        </div>
        
        <!-- Popup for mobile -->
        <div class="status-popup" id="popup-{{ forloop.index }}" data-status-id="status-{{ forloop.index }}">
            <button class="status-popup-close">×</button>
            <div class="status-popup-content">
                <div class="status-popup-avatar">
                    <img src="/images/douban_avatar.jpg" alt="Avatar">
                    <span class="status-popup-time">{{ status.time }}</span>
                </div>
                <div class="status-popup-text">{{ status.content }}</div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p>No data found for year {{ year_str }} (Debug: page.year={{ page.year }})</p>
        {% endif %}
    </div>
</div>

<script>
    // Mobile popup functionality
    document.addEventListener('DOMContentLoaded', function() {
        // Only run on mobile
        if (window.innerWidth > 768) return;
        
        // Handle popup open
        document.addEventListener('click', function(e) {
            // Find the closest status bubble that was clicked
            const bubble = e.target.closest('.status-bubble');
            if (!bubble) return;
            
            // Don't trigger if clicking on a link
            if (e.target.tagName === 'A') return;
            
            // Get the target popup ID from the data attribute
            const popupId = bubble.getAttribute('data-popup-target');
            if (!popupId) return;
            
            const popup = document.getElementById(popupId);
            if (popup) {
                // Hide all other popups first
                document.querySelectorAll('.status-popup').forEach(p => {
                    p.classList.remove('active');
                });
                
                // Show the correct popup
                document.body.style.overflow = 'hidden';
                popup.classList.add('active');
                
                // Prevent the click from bubbling up
                e.stopPropagation();
            }
        });
        
        // Handle popup close
        document.addEventListener('click', function(e) {
            const popup = e.target.closest('.status-popup');
            const closeBtn = e.target.closest('.status-popup-close');
            
            // If clicking the close button or outside the popup content
            if (closeBtn || (popup && e.target === popup)) {
                document.body.style.overflow = '';
                document.querySelectorAll('.status-popup').forEach(p => {
                    p.classList.remove('active');
                });
                e.stopPropagation();
            }
        });
        
        // Close popup when pressing ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.body.style.overflow = '';
                document.querySelectorAll('.status-popup').forEach(popup => {
                    popup.classList.remove('active');
                });
            }
        });
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            document.body.style.overflow = '';
            document.querySelectorAll('.status-popup').forEach(popup => {
                popup.classList.remove('active');
            });
        }
    });
</script>