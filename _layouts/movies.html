---
layout: default
---

<link rel="stylesheet" href="/assets/css/movies.css">

<div class="movies-container" data-theme="light">

    {% if page.dataset %}
    {% assign dataset_str = page.dataset | append: "" %}
    {% assign year_data = site.data.movies[dataset_str] %}
    {% elsif page.year %}
    {% assign year_str = page.year | append: "" %}
    {% assign year_data = site.data.movies[year_str] %}
    {% endif %}

    {% if year_data %}
    <!-- Stats -->
    <div class="movies-stats">
        <span>å…±è§‚çœ‹ <strong>{{ year_data | size }}</strong> éƒ¨ç”µå½±</span>
        {% assign total_rating = 0 %}
        {% assign rated_count = 0 %}
        {% for movie in year_data %}
        {% if movie.my_rating %}
        {% assign total_rating = total_rating | plus: movie.my_rating %}
        {% assign rated_count = rated_count | plus: 1 %}
        {% endif %}
        {% endfor %}
        {% if rated_count > 0 %}
        {% assign avg_rating = total_rating | divided_by: rated_count %}
        <span class="divider">|</span>
        <span>å¹³å‡è¯„åˆ† <strong>{{ avg_rating }}</strong> æ˜Ÿ</span>
        {% endif %}
    </div>

    <!-- View Toggle -->
    <div class="movies-controls">
        <div class="view-mode-links">
            <a href="#" class="mode-link active" data-mode="normal">å›¾ç‰‡</a>
            <span class="mode-divider">/</span>
            <a href="#" class="mode-link" data-mode="minimal">æ–‡å­—</a>
        </div>
    </div>


    <div class="movies-grid" id="movies-grid">
        {% for movie in year_data %}
        <a href="{{ movie.douban_url }}" target="_blank" class="movie-card"
            data-douban-rating="{{ movie.douban_rating | default: 0 }}" data-date="{{ movie.watched_date }}"
            data-pub-date="{{ movie.pub_date | default: movie.year }}" data-title="{{ movie.title }}"
            data-genres="{{ movie.genres | join: ',' }}" data-countries="{{ movie.countries }}">

            <!-- Poster -->
            <div class="movie-poster">
                {% if movie.poster %}
                <img src="{{ movie.poster }}" alt="{{ movie.title }}" loading="lazy">
                {% else %}
                <div class="poster-placeholder">
                    <span>ğŸ“½ï¸</span>
                </div>
                {% endif %}
            </div>

            <!-- Info -->
            <div class="movie-info">
                <h3 class="movie-title" title="{{ movie.title }}">
                    {{ movie.title }}
                </h3>

                {% if movie.original_title and movie.original_title != movie.title %}
                <p class="movie-original-title" title="{{ movie.original_title }}">
                    {{ movie.original_title }}
                </p>
                {% endif %}

                <div class="movie-meta">
                    {% if movie.my_rating %}
                    <div class="movie-rating">
                        {% for i in (1..5) %}
                        <span class="star {% if i <= movie.my_rating %}filled{% endif %}">â˜…</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if movie.watched_date %}
                    <div class="movie-date">{{ movie.watched_date }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Tooltip (shown on hover) -->
            <div class="movie-tooltip">
                {% if movie.poster %}
                <div class="tooltip-poster">
                    <img src="{{ movie.poster }}" alt="{{ movie.title }}" loading="lazy">
                </div>
                {% endif %}
                <div class="tooltip-content">
                    {% if movie.directors and movie.directors.size > 0 %}
                    <p><strong>å¯¼æ¼”ï¼š</strong>{{ movie.directors | join: " / " }}</p>
                    {% endif %}
                    {% if movie.cast and movie.cast.size > 0 %}
                    <p><strong>ä¸»æ¼”ï¼š</strong>{{ movie.cast | slice: 0, 5 | join: " / " }}</p>
                    {% endif %}
                    {% if movie.genres and movie.genres.size > 0 %}
                    <p><strong>ç±»å‹ï¼š</strong>{{ movie.genres | join: " / " }}</p>
                    {% endif %}
                    {% if movie.countries %}
                    <p><strong>å›½å®¶ï¼š</strong>{{ movie.countries }}</p>
                    {% endif %}
                    {% if movie.pub_date %}
                    <p><strong>ä¸Šæ˜ ï¼š</strong>{{ movie.pub_date }}</p>
                    {% endif %}
                    {% if movie.douban_rating %}
                    <p><strong>è±†ç“£ï¼š</strong><span class="rating-highlight">{{ movie.douban_rating }}</span>{% if
                        movie.rating_count %} ({{ movie.rating_count }}äºº){% endif %}</p>
                    {% endif %}
                    {% if movie.my_comment %}
                    <p class="tooltip-comment">ğŸ’¬ {{ movie.my_comment }}</p>
                    {% endif %}
                </div>
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Empty state -->
    <div class="movies-empty" id="movies-empty" style="display: none;">
        <p>ğŸ“­ æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ç”µå½±</p>
    </div>

    {% else %}
    <div class="movies-empty">
        <p>ğŸ“­ æš‚æ— è§‚å½±è®°å½•</p>
    </div>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const grid = document.getElementById('movies-grid');
        const emptyState = document.getElementById('movies-empty');
        const modeLinks = document.querySelectorAll('.mode-link');

        if (!grid) return;

        const cards = Array.from(grid.querySelectorAll('.movie-card'));
        let currentMode = 'normal';

        function renderMovies() {
            // Toggle view mode class
            if (currentMode === 'minimal') {
                grid.classList.add('minimal-mode');
            } else {
                grid.classList.remove('minimal-mode');
            }

            // Sort by pub-date descending
            const sortedCards = [...cards].sort((a, b) => {
                const dateA = a.dataset.pubDate || '';
                const dateB = b.dataset.pubDate || '';
                return dateB.localeCompare(dateA);
            });

            // Remove existing dividers
            grid.querySelectorAll('.year-divider').forEach(d => d.remove());

            // Show and reorder cards with year dividers
            let currentYear = null;
            sortedCards.forEach((card, index) => {
                card.style.display = '';
                card.style.order = index * 2 + 1;

                const year = card.dataset.pubDate ? card.dataset.pubDate.substring(0, 4) : 'æœªçŸ¥å¹´ä»½';
                if (year !== currentYear) {
                    currentYear = year;
                    const divider = document.createElement('div');
                    divider.className = 'year-divider';
                    divider.style.order = index * 2;
                    divider.textContent = `${year} å¹´`;
                    grid.appendChild(divider);
                }
            });

            // Toggle empty state
            if (emptyState) {
                emptyState.style.display = sortedCards.length === 0 ? 'block' : 'none';
            }
        }

        // Event listener for mode links
        modeLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                modeLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                currentMode = this.dataset.mode;
                renderMovies();
            });
        });

        // Initial render
        renderMovies();
    });
</script>