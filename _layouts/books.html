---
layout: default
---

<link rel="stylesheet" href="/assets/css/books.css">

<div class="books-container">

    {% if page.dataset %}
    {% assign dataset_str = page.dataset | append: "" %}
    {% assign book_data = site.data.books[dataset_str] %}
    {% endif %}

    {% if book_data %}
    <!-- Stats -->
    <div class="books-stats">
        <span>å…± <strong>{{ book_data | size }}</strong> æœ¬ä¹¦</span>
    </div>

    <!-- View Toggle -->
    <div class="books-controls">
        <div class="view-mode-links">
            <a href="#" class="mode-link active" data-mode="normal">å›¾ç‰‡</a>
            <span class="mode-divider">/</span>
            <a href="#" class="mode-link" data-mode="minimal">æ–‡å­—</a>
        </div>
    </div>

    <div class="books-grid" id="books-grid">

        {% for book in book_data %}
        <a href="{{ book.douban_url }}" target="_blank" class="book-card"
            data-douban-rating="{{ book.douban_rating | default: 0 }}" data-read-date="{{ book.read_date }}"
            data-publish-date="{{ book.publish_date }}" data-title="{{ book.title }}"
            data-status="{{ book.status | default: 'collect' }}" data-author="{{ book.author }}">

            <!-- Cover -->
            <div class="book-cover">
                {% if book.cover %}
                <img src="{{ book.cover }}" alt="{{ book.title }}" loading="lazy">
                {% else %}
                <div class="cover-placeholder">
                    <span>ğŸ“š</span>
                </div>
                {% endif %}
            </div>

            <!-- Info -->
            <div class="book-info">
                <h3 class="book-title" title="{{ book.title }}">
                    {{ book.title }}
                </h3>

                <div class="book-author">{{ book.author }}</div>

                <div class="book-meta">
                    {% if book.my_rating %}
                    <div class="book-rating">
                        {% for i in (1..5) %}
                        <span class="star {% if i <= book.my_rating %}filled{% endif %}">â˜…</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if book.publish_date %}
                    <div class="book-date">{{ book.publish_date }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Tooltip -->
            <!-- Tooltip -->
            <div class="book-tooltip">
                {% if book.cover %}
                <div class="tooltip-poster">
                    <img src="{{ book.cover }}" alt="{{ book.title }}" loading="lazy">
                </div>
                {% endif %}
                <div class="tooltip-content">
                    {% if book.author %}
                    <p><strong>ä½œè€…ï¼š</strong>{{ book.author }}</p>
                    {% endif %}
                    {% if book.translator %}
                    <p><strong>è¯‘è€…ï¼š</strong>{{ book.translator }}</p>
                    {% endif %}
                    {% if book.publisher %}
                    <p><strong>å‡ºç‰ˆç¤¾ï¼š</strong>{{ book.publisher }}</p>
                    {% endif %}
                    {% if book.publish_date %}
                    <p><strong>å‡ºç‰ˆæ—¥æœŸï¼š</strong>{{ book.publish_date }}</p>
                    {% endif %}
                    {% if book.pages %}
                    <p><strong>é¡µæ•°ï¼š</strong>{{ book.pages }}</p>
                    {% endif %}
                    {% if book.douban_rating %}
                    <p><strong>è±†ç“£ï¼š</strong><span class="rating-highlight">{{ book.douban_rating }}</span>{% if
                        book.rating_count %} ({{ book.rating_count }}äºº){% endif %}</p>
                    {% endif %}
                    {% if book.my_comment %}
                    <p class="tooltip-comment">ğŸ’¬ {{ book.my_comment }}</p>
                    {% endif %}
                </div>
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Empty state -->
    <div class="books-empty" id="books-empty" style="display: none;">
        <p>ğŸ“­ æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ä¹¦ç±</p>
    </div>

    {% else %}
    <div class="books-empty">
        <p>ğŸ“­ æš‚æ— è¯»ä¹¦è®°å½•</p>
    </div>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const grid = document.getElementById('books-grid');
        const emptyState = document.getElementById('books-empty');
        const modeLinks = document.querySelectorAll('.mode-link');

        if (!grid) return;

        const cards = Array.from(grid.querySelectorAll('.book-card'));
        let currentMode = 'normal';

        function renderBooks() {
            // Toggle view mode class
            if (currentMode === 'minimal') {
                grid.classList.add('minimal-mode');
            } else {
                grid.classList.remove('minimal-mode');
            }

            // Sort by publish-date descending
            const sortedCards = [...cards].sort((a, b) => {
                const dateA = a.dataset.publishDate || '';
                const dateB = b.dataset.publishDate || '';
                // Extract year for comparison
                const yearA = dateA.match(/\d{4}/)?.[0] || '0000';
                const yearB = dateB.match(/\d{4}/)?.[0] || '0000';
                return yearB.localeCompare(yearA);
            });

            // Reorder cards
            sortedCards.forEach((card, index) => {
                card.style.display = '';
                card.style.order = index;
            });

            // Toggle empty state
            if (emptyState) {
                emptyState.style.display = sortedCards.length === 0 ? 'block' : 'none';
            }
        }

        // Event listener for mode links
        modeLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                modeLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                currentMode = this.dataset.mode;
                renderBooks();
            });
        });

        // Initial render
        renderBooks();
    });
</script>