---
layout: default
---

<link rel="stylesheet" href="/assets/css/games.css">

<div class="games-container">

    {% if page.dataset %}
    {% assign dataset_str = page.dataset | append: "" %}
    {% assign game_data = site.data.games[dataset_str] %}
    {% endif %}

    {% if game_data %}
    <!-- Stats -->
    <div class="games-stats">
        <span>å…±ç©è¿‡ <strong>{{ game_data | size }}</strong> æ¬¾æ¸¸æˆ</span>
        {% assign total_rating = 0 %}
        {% assign rated_count = 0 %}
        {% for game in game_data %}
        {% if game.my_rating %}
        {% assign total_rating = total_rating | plus: game.my_rating %}
        {% assign rated_count = rated_count | plus: 1 %}
        {% endif %}
        {% endfor %}
        {% if rated_count > 0 %}
        {% assign avg_rating = total_rating | divided_by: rated_count %}
        <span class="divider">|</span>
        <span>å¹³å‡è¯„åˆ† <strong>{{ avg_rating }}</strong> æ˜Ÿ</span>
        {% endif %}
    </div>

    <!-- View Toggle -->
    <div class="games-controls">
        <div class="view-mode-links">
            <a href="#" class="mode-link active" data-mode="normal">å›¾ç‰‡</a>
            <span class="mode-divider">/</span>
            <a href="#" class="mode-link" data-mode="minimal">æ–‡å­—</a>
        </div>
    </div>

    <div class="games-grid" id="games-grid">


        {% for game in game_data %}
        <a href="{{ game.douban_url }}" target="_blank" class="game-card"
            data-douban-rating="{{ game.douban_rating | default: 0 }}" data-date="{{ game.played_date }}"
            data-release-date="{{ game.release_date }}" data-title="{{ game.title }}"
            data-genres="{{ game.genres | join: ',' }}" data-platforms="{{ game.platforms | join: ',' }}">

            <!-- Cover -->
            <div class="game-cover">
                {% if game.cover %}
                <img src="{{ game.cover }}" alt="{{ game.title }}" loading="lazy">
                {% else %}
                <div class="cover-placeholder">
                    <span>ğŸ®</span>
                </div>
                {% endif %}
            </div>

            <!-- Info -->
            <div class="game-info">
                <h3 class="game-title" title="{{ game.title }}">
                    {{ game.title }}
                </h3>

                <div class="game-meta">
                    {% if game.my_rating %}
                    <div class="game-rating">
                        {% for i in (1..5) %}
                        <span class="star {% if i <= game.my_rating %}filled{% endif %}">â˜…</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if game.played_date %}
                    <div class="game-date">{{ game.played_date }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Tooltip -->
            <div class="game-tooltip">
                {% if game.platforms and game.platforms.size > 0 %}
                <p><strong>å¹³å°ï¼š</strong>{{ game.platforms | join: " / " }}</p>
                {% endif %}
                {% if game.genres and game.genres.size > 0 %}
                <p><strong>ç±»å‹ï¼š</strong>{{ game.genres | join: " / " }}</p>
                {% endif %}
                {% if game.developer %}
                <p><strong>å¼€å‘ï¼š</strong>{{ game.developer }}</p>
                {% endif %}
                {% if game.publisher %}
                <p><strong>å‘è¡Œï¼š</strong>{{ game.publisher }}</p>
                {% endif %}
                {% if game.release_date %}
                <p><strong>å‘è¡Œæ—¥æœŸï¼š</strong>{{ game.release_date }}</p>
                {% endif %}
                {% if game.douban_rating %}
                <p><strong>è±†ç“£ï¼š</strong><span class="rating-highlight">{{ game.douban_rating }}</span>{% if
                    game.rating_count %} ({{ game.rating_count }}äºº){% endif %}</p>
                {% endif %}
                {% if game.my_comment %}
                <p class="tooltip-comment">ğŸ’¬ {{ game.my_comment }}</p>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Empty state -->
    <div class="games-empty" id="games-empty" style="display: none;">
        <p>ğŸ“­ æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ¸¸æˆ</p>
    </div>

    {% else %}
    <div class="games-empty">
        <p>ğŸ“­ æš‚æ— æ¸¸æˆè®°å½•</p>
    </div>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const grid = document.getElementById('games-grid');
        const emptyState = document.getElementById('games-empty');
        const modeLinks = document.querySelectorAll('.mode-link');

        if (!grid) return;

        const cards = Array.from(grid.querySelectorAll('.game-card'));
        let currentMode = 'normal';

        function renderGames() {
            // Toggle view mode class
            if (currentMode === 'minimal') {
                grid.classList.add('minimal-mode');
            } else {
                grid.classList.remove('minimal-mode');
            }

            // Sort by release-date descending
            const sortedCards = [...cards].sort((a, b) => {
                const dateA = a.dataset.releaseDate || '';
                const dateB = b.dataset.releaseDate || '';
                return dateB.localeCompare(dateA);
            });

            // Reorder cards
            sortedCards.forEach((card, index) => {
                card.style.display = '';
                card.style.order = index;
            });

            // Toggle empty state
            if (emptyState) {
                emptyState.style.display = sortedCards.length === 0 ? 'block' : 'none';
            }
        }

        // Event listener for mode links
        modeLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                modeLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                currentMode = this.dataset.mode;
                renderGames();
            });
        });

        // Initial render
        renderGames();
    });
</script>